<div class="documentation-content">

<div class="wiki-content" id="main-content">

        <h1 id="MicroserviceTemplatingwithPHPSmarty-SmartyTemplates"><span class="">Smarty Templates </span></h1><p>The Smarty templates are used to generate output using variables and control structures like <strong>if/then/else</strong> conditional branches or <strong>foreach</strong> loops. The outputs are used to configure devices or retrieve data from the database.</p><h2 id="MicroserviceTemplatingwithPHPSmarty-Variables">V<span class="">ariables </span></h2><h3 id="MicroserviceTemplatingwithPHPSmarty-FromDatabase"><span class="">From Database </span></h3><p>For an object <em>object_name</em>, the instance instance_id can accessed with the syntax</p><pre>{$object_name.instance_id}
</pre><p>Object fields can be accessed via</p><pre>{$object_name.instance_id.field_name}
</pre><p>Array values can be accessed with the syntax</p><pre>{$object_name.instance_id.array_name.array_index}
</pre><h3 id="MicroserviceTemplatingwithPHPSmarty-FromParameters"><span class="">F</span><span class="">rom Parameters </span></h3><p>Variables generated from parameters are accessed by using the syntax</p><pre>{$params.name}
</pre><h3 id="MicroserviceTemplatingwithPHPSmarty-SpecialCaseofobject_idTthespecialvariable"><span class="">Special Case of object_idT</span>the special variable</h3><pre>{$object_id}
</pre><p>can also be used. It corresponds to the <em>object ID</em> given in the JSON parameter object.</p><p>The {$object_id} variable can also be used to retrieve an object instance from the database.</p><pre>{$object_name[$object_id|object_id]}
</pre><p>is the instance of <em>object_name</em> corresponding to the <em>object ID</em> given in parameters.</p><p>Smarty has a specific meaning for the '.' dot character, so it is not allowed in $object_id variable. In order to solve this issue, it is better to use {$params.object_id} instead of {$object_id} when generating the configuration.</p><p>In order to reference the value of another object, the Smarty modifier '|object_id' can be use.</p><p>For example:</p><pre>v2.0/subnets/{$subnets[$params.object_id|object_id].uuid}
</pre><p>will fetch the <em>uuid</em> parameter of the <em>subnets</em> object having <em>$params.object_id</em> id.</p><h2 id="MicroserviceTemplatingwithPHPSmarty-ControlStructures"><span class="">Control Structures</span></h2><p>Control structures are used to generated output using complex data, like list of objects, or optional parts.</p><h3 id="MicroserviceTemplatingwithPHPSmarty-Conditionals"><span class="">Conditionals </span></h3><pre>{if},{elseif},{else}
</pre><p>{if} statements in Smarty have much the same flexibility as PHP if statements, with a few added features for the template engine. Every {if} must be paired with a matching {/if}. {else} and {elseif} are also permitted. All PHP conditionals and functions are recognized, such as ||, or, &amp;&amp;, and, is_array(), etc.</p><p>The following is a list of recognized qualifiers, which must be separated from surrounding elements by spaces. Note that items listed in [brackets] are optional. PHP equivalents are shown where applicable.</p><div class="table-wrap"><table class="wrapped confluenceTable tablesorter tablesorter-default stickyTableHeaders" role="grid" style="padding: 0px;"><colgroup><col/><col/><col/><col/><col/></colgroup><thead class="tableFloatingHeaderOriginal"><tr class="tablesorter-headerRow" role="row"><th aria-disabled="false" aria-label="Qualifier: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="0" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Qualifier</div></th><th aria-disabled="false" aria-label="Alternates: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="1" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Alternates</div></th><th aria-disabled="false" aria-label="Syntax Example: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="2" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Syntax Example</div></th><th aria-disabled="false" aria-label="Meaning: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="3" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Meaning</div></th><th aria-disabled="false" aria-label="PHP Equivalent: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="4" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">PHP Equivalent</div></th></tr></thead><thead class="tableFloatingHeader" style="display: none;"><tr class="tablesorter-headerRow" role="row"><th aria-disabled="false" aria-label="Qualifier: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="0" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Qualifier</div></th><th aria-disabled="false" aria-label="Alternates: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="1" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Alternates</div></th><th aria-disabled="false" aria-label="Syntax Example: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="2" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Syntax Example</div></th><th aria-disabled="false" aria-label="Meaning: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="3" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Meaning</div></th><th aria-disabled="false" aria-label="PHP Equivalent: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="4" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">PHP Equivalent</div></th></tr></thead><tbody aria-live="polite" aria-relevant="all"><tr role="row"><td class="confluenceTd">==</td><td class="confluenceTd">eq</td><td class="confluenceTd">$a eq $b</td><td class="confluenceTd">equals</td><td class="confluenceTd">==</td></tr><tr role="row"><td class="confluenceTd"> !=</td><td class="confluenceTd">ne, neq</td><td class="confluenceTd">$a neq $b</td><td class="confluenceTd">not equals</td><td class="confluenceTd"> !=</td></tr><tr role="row"><td class="confluenceTd">&gt;</td><td class="confluenceTd">gt</td><td class="confluenceTd">$a gt $b</td><td class="confluenceTd">greater than</td><td class="confluenceTd">&gt;</td></tr><tr role="row"><td class="confluenceTd">&lt;</td><td class="confluenceTd">lt</td><td class="confluenceTd">$a lt $b</td><td class="confluenceTd">less than</td><td class="confluenceTd">&lt;</td></tr><tr role="row"><td class="confluenceTd">&gt;=</td><td class="confluenceTd">gte, ge</td><td class="confluenceTd">$a ge $b</td><td class="confluenceTd">greater than or equal</td><td class="confluenceTd">&gt;=</td></tr><tr role="row"><td class="confluenceTd">&lt;=</td><td class="confluenceTd">lte, le</td><td class="confluenceTd">$a le $b</td><td class="confluenceTd">less than or equal</td><td class="confluenceTd">&lt;=</td></tr><tr role="row"><td class="confluenceTd">===</td><td class="confluenceTd"></td><td class="confluenceTd">$a === 0</td><td class="confluenceTd">check for identity</td><td class="confluenceTd">===</td></tr><tr role="row"><td class="confluenceTd"> !</td><td class="confluenceTd">not</td><td class="confluenceTd">not $a</td><td class="confluenceTd">negation (unary)</td><td class="confluenceTd"> !</td></tr><tr role="row"><td class="confluenceTd"> %</td><td class="confluenceTd">mod</td><td class="confluenceTd">$a mod $b</td><td class="confluenceTd">modulous</td><td class="confluenceTd"> %</td></tr><tr role="row"><td class="confluenceTd">is [not] div by</td><td class="confluenceTd"></td><td class="confluenceTd">$a is not div by 4</td><td class="confluenceTd">divisible by</td><td class="confluenceTd">$a % $b == 0</td></tr><tr role="row"><td class="confluenceTd">is [not] even</td><td class="confluenceTd"></td><td class="confluenceTd">$a is not even</td><td class="confluenceTd">[not] an even number (unary)</td><td class="confluenceTd">$a % 2 == 0</td></tr><tr role="row"><td class="confluenceTd">is [not] even by</td><td class="confluenceTd"></td><td class="confluenceTd">$a is not even by $b</td><td class="confluenceTd">grouping level [not] even</td><td class="confluenceTd">($a / $b) % 2 == 0</td></tr><tr role="row"><td class="confluenceTd">is [not] odd</td><td class="confluenceTd"></td><td class="confluenceTd">$a is not odd</td><td class="confluenceTd">[not] an odd number (unary)</td><td class="confluenceTd">$a % 2 != 0</td></tr><tr role="row"><td class="confluenceTd">is [not] odd by</td><td class="confluenceTd"></td><td class="confluenceTd">$a is not odd by $b</td><td class="confluenceTd">[not] an odd grouping</td><td class="confluenceTd">($a / $b) % 2 != 0</td></tr></tbody></table></div><p>Example:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_620226"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">telephony-service</code></div><div class="line number2 index1 alt1"><code class="java plain">{</code><code class="java keyword">if</code> <code class="java plain">isset($params.ntp_server_ip_address) &amp;&amp; $params.ntp_server_ip_address != </code><code class="java string">''</code><code class="java plain">}</code></div><div class="line number3 index2 alt2"><code class="java spaces"> </code><code class="java plain">ntp-server {$params.ntp_server_ip_address}</code></div><div class="line number4 index3 alt1"><code class="java plain">{/</code><code class="java keyword">if</code><code class="java plain">}</code></div><div class="line number5 index4 alt2"><code class="java plain">{</code><code class="java keyword">if</code> <code class="java plain">isset($params.maximum_ephones) &amp;&amp; $params.maximum_ephones != </code><code class="java string">''</code><code class="java plain">}</code></div><div class="line number6 index5 alt1"><code class="java spaces"> </code><code class="java plain">max-ephones {$params.maximum_ephones} </code></div><div class="line number7 index6 alt2"><code class="java plain">{/</code><code class="java keyword">if</code><code class="java plain">}</code></div><div class="line number8 index7 alt1"><code class="java plain">{</code><code class="java keyword">if</code> <code class="java plain">isset($params.maximum_dial_numbers) &amp;&amp; $params.maximum_dial_numbers != </code><code class="java string">''</code><code class="java plain">}</code></div><div class="line number9 index8 alt2"><code class="java spaces"> </code><code class="java plain">max-dn {$params.maximum_dial_numbers} </code></div><div class="line number10 index9 alt1"><code class="java plain">{/</code><code class="java keyword">if</code><code class="java plain">}</code></div><div class="line number11 index10 alt2"><code class="java plain">{</code><code class="java keyword">if</code> <code class="java plain">isset($params.source_ip_address) &amp;&amp; $params.source_ip_address != </code><code class="java string">''</code><code class="java plain">}</code></div><div class="line number12 index11 alt1"><code class="java spaces"> </code><code class="java plain">ip source-address {$params.source_ip_address} port {$params.source_port} {</code><code class="java keyword">if</code> <code class="java plain">isset($params.secondary_ip_address) &amp;&amp; $params.secondary_ip_address != </code><code class="java string">''</code><code class="java plain">} secondary {$params.secondary_ip_address} {/</code><code class="java keyword">if</code><code class="java plain">} </code></div><div class="line number13 index12 alt2"><code class="java plain">{/</code><code class="java keyword">if</code><code class="java plain">}</code></div><div class="line number14 index13 alt1"><code class="java plain">...</code></div></div></code></tr></tbody></table></div></div>
</div></div><h3 id="MicroserviceTemplatingwithPHPSmarty-Loops"><span class="">L</span><span class="">oops </span></h3><pre>{foreach},{foreachelse}
</pre><p>{foreach} is used to loop over an associative array as well a numerically-indexed array, unlike {section} which is for looping over numerically-indexed arrays only. The syntax for {foreach} is much easier than {section}, but as a tradeoff it can only be used for a single array. Every {foreach} tag must be paired with a closing {/foreach} tag.</p><div class="table-wrap"><table class="wrapped confluenceTable tablesorter tablesorter-default stickyTableHeaders" role="grid" style="padding: 0px;"><colgroup><col/><col/><col/><col/><col/></colgroup><thead class="tableFloatingHeaderOriginal"><tr class="tablesorter-headerRow" role="row"><th aria-disabled="false" aria-label="Attribute Name: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="0" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Attribute Name</div></th><th aria-disabled="false" aria-label="Type: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="1" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Type</div></th><th aria-disabled="false" aria-label="Required: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="2" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Required</div></th><th aria-disabled="false" aria-label="Default: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="3" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Default</div></th><th aria-disabled="false" aria-label="Description: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="4" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Description</div></th></tr></thead><thead class="tableFloatingHeader" style="display: none;"><tr class="tablesorter-headerRow" role="row"><th aria-disabled="false" aria-label="Attribute Name: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="0" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Attribute Name</div></th><th aria-disabled="false" aria-label="Type: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="1" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Type</div></th><th aria-disabled="false" aria-label="Required: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="2" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Required</div></th><th aria-disabled="false" aria-label="Default: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="3" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Default</div></th><th aria-disabled="false" aria-label="Description: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="4" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Description</div></th></tr></thead><tbody aria-live="polite" aria-relevant="all"><tr role="row"><td class="confluenceTd">from</td><td class="confluenceTd">array</td><td class="confluenceTd">Yes</td><td class="confluenceTd">n/a</td><td class="confluenceTd">The array you are looping through</td></tr><tr role="row"><td class="confluenceTd">item</td><td class="confluenceTd">string</td><td class="confluenceTd">Yes</td><td class="confluenceTd">n/a</td><td class="confluenceTd">The name of the variable that is the current element</td></tr><tr role="row"><td class="confluenceTd">key</td><td class="confluenceTd">string</td><td class="confluenceTd">No</td><td class="confluenceTd">n/a</td><td class="confluenceTd">The name of the variable that is the current key</td></tr></tbody></table></div><ul><li>Required attributes are from and item.</li><li>{foreach} loops can be nested.</li><li>The from attribute, usually an array of values, determines the number of times {foreach} will loop.</li><li>{foreachelse} is executed when there are no values in the from variable.</li></ul><p>Example:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_113898"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">telephony-service</code></div><div class="line number2 index1 alt1"><code class="java plain">{foreach from=$params.tftp_load item=tftp}</code></div><div class="line number3 index2 alt2"><code class="java spaces"> </code><code class="java plain">load {$tftp.phone_type} {$tftp.firmware_file_name}</code></div><div class="line number4 index3 alt1"><code class="java plain">{/foreach}</code></div></div></code></tr></tbody></table></div></div>
</div></div><h3 id="MicroserviceTemplatingwithPHPSmarty-VariableAssignment">V<span class="">ariable Assignment </span></h3><p>Under certain circumstances it is necessary to use a local temporary variable to generate the output.</p><pre>{assign}
</pre><p>{assign} is used for assigning template variables during the execution of a template.</p><div class="table-wrap"><table class="wrapped confluenceTable tablesorter tablesorter-default stickyTableHeaders" role="grid" style="padding: 0px;"><colgroup><col/><col/><col/><col/><col/></colgroup><thead class="tableFloatingHeaderOriginal"><tr class="tablesorter-headerRow" role="row"><th aria-disabled="false" aria-label="Attribute Name: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="0" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Attribute Name</div></th><th aria-disabled="false" aria-label="Type: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="1" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Type</div></th><th aria-disabled="false" aria-label="Required: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="2" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Required</div></th><th aria-disabled="false" aria-label="Default: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="3" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Default</div></th><th aria-disabled="false" aria-label="Description: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="4" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Description</div></th></tr></thead><thead class="tableFloatingHeader" style="display: none;"><tr class="tablesorter-headerRow" role="row"><th aria-disabled="false" aria-label="Attribute Name: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="0" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Attribute Name</div></th><th aria-disabled="false" aria-label="Type: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="1" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Type</div></th><th aria-disabled="false" aria-label="Required: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="2" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Required</div></th><th aria-disabled="false" aria-label="Default: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="3" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Default</div></th><th aria-disabled="false" aria-label="Description: No sort applied, activate to apply an ascending sort" aria-sort="none" class="confluenceTh tablesorter-header sortableHeader tablesorter-headerUnSorted" data-column="4" role="columnheader" scope="col" style="user-select: none;" tabindex="0" unselectable="on"><div class="tablesorter-header-inner">Description</div></th></tr></thead><tbody aria-live="polite" aria-relevant="all"><tr role="row"><td class="confluenceTd">var</td><td class="confluenceTd">string</td><td class="confluenceTd">Yes</td><td class="confluenceTd">n/a</td><td class="confluenceTd">The name of the variable being assigned</td></tr><tr role="row"><td class="confluenceTd">value</td><td class="confluenceTd">string</td><td class="confluenceTd">Yes</td><td class="confluenceTd">n/a</td><td class="confluenceTd">The value being assigned</td></tr></tbody></table></div><p>Example:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_683691"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">!</code></div><div class="line number2 index1 alt1"><code class="java plain">{assign var=</code><code class="java string">'sdid'</code> <code class="java plain">value=$SD-&gt;SDID}</code></div><div class="line number3 index2 alt2"><code class="java plain">{foreach from=$VOIP_PROFILE-&gt;SD_list.$sdid-&gt;MAIL_BOX_list item=mbox}</code></div><div class="line number4 index3 alt1"><code class="java plain">!</code></div><div class="line number5 index4 alt2"><code class="java plain">voicemail mailbox owner {$mbox-&gt;MBOX_USERNAME}</code></div><div class="line number6 index5 alt1"><code class="java plain">login pinless any-phone-number</code></div><div class="line number7 index6 alt2"><code class="java plain">end mailbox</code></div><div class="line number8 index7 alt1"><code class="java plain">{/foreach}</code></div><div class="line number9 index8 alt2"><code class="java plain">!</code></div></div></code></tr></tbody></table></div></div>
</div></div><h2 id="MicroserviceTemplatingwithPHPSmarty-CommonProblems"><span class="">Common Problems </span></h2><p>The templates are extracted from the XML definition files, and evaluated with Smarty. Some behavior must be known prior to developing templates.</p><h3 id="MicroserviceTemplatingwithPHPSmarty-XMLNonSupportedCharacters"><span class="">XML Non Supported Characters </span></h3><p>Templates within XML definition files must not contain characters like <strong>&lt;</strong> or <strong>&gt;</strong>. You'll get an error:</p><pre>Bad format for local file
</pre><p>due to XML parsing error.</p><p>For example:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter xml" id="highlighter_77166"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">command</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"CREATE"</code><code class="xml plain">&gt;</code></div><div class="line number2 index1 alt1"><code class="xml spaces">    </code><code class="xml plain">&lt;</code><code class="xml keyword">operation</code><code class="xml plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="xml plain">you can't "write" if ({$foo} &lt; </code><code class="xml keyword">1</code><code class="xml plain">) in your templates</code></div><div class="line number4 index3 alt1"><code class="xml spaces">    </code><code class="xml plain">&lt;/operation&gt;</code></div><div class="line number5 index4 alt2"><code class="xml plain">&lt;/</code><code class="xml keyword">command</code><code class="xml plain">&gt;</code></div></div></code></tr></tbody></table></div></div>
</div></div><p> Templates must be embedded into a <strong>&lt;[CDATA[</strong> <strong>]]&gt;</strong> tag to avoid most of the problems of non-supported characters.</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_626732"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java spaces">    </code><code class="java plain">&lt;command name=</code><code class="java string">"CREATE"</code><code class="java plain">&gt;</code></div><div class="line number2 index1 alt1"><code class="java spaces">        </code><code class="java plain">&lt;operation&gt;&lt;[CDATA[</code></div><div class="line number3 index2 alt2"><code class="java spaces">    </code><code class="java plain">you can </code><code class="java string">"write"</code> <code class="java keyword">if</code> <code class="java plain">({$foo} &lt; </code><code class="java value">1</code><code class="java plain">) in your templates</code></div><div class="line number4 index3 alt1"><code class="java plain">]]&gt;&lt;/operation&gt;</code></div><div class="line number5 index4 alt2"><code class="java spaces">    </code><code class="java plain">&lt;/command&gt;</code></div></div></code></tr></tbody></table></div></div>
</div></div><h3 id="MicroserviceTemplatingwithPHPSmarty-ExtraLineBreakandSpaceCharacters"><span class="">Extra Line Break and Space Characters </span></h3><p>The templates reflects what is written within the <strong>&lt;operation&gt;</strong> and <strong>&lt;/operation&gt;</strong> tags, that's why it is recommended to write</p>
<p>
  <a class="image-popup-fit-width" href="">
        <img alt="Image" src="images/Linebreak.png" width="800"/></a>
</p>
<p>When a Smarty command like {if} {foreach}, or also an ending tag like {/if} {/foreach}, is immediately followed by a line break, then this line break is <strong>REMOVED</strong> by Smarty. This does <strong>NOT</strong> apply to variables.</p><p>Example:</p>
<p>
  <a class="image-popup-fit-width" href="">
        <img alt="Image" src="images/FireShot_capture_-115.png" width="800"/></a>
</p>
<p>In this case the</p><pre>{if} ... {/if}
</pre><p>The line should have been split.</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_134806"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">!</code></div><div class="line number2 index1 alt1"><code class="java plain">{assign var=</code><code class="java string">'sdid'</code> <code class="java plain">value=$SD-&gt;SDID}</code></div><div class="line number3 index2 alt2"><code class="java plain">{foreach from=$VOIP_PROFILE-&gt;SD_list.$sdid-&gt;MAIL_BOX_list item=mbox}</code></div><div class="line number4 index3 alt1"><code class="java plain">!</code></div><div class="line number5 index4 alt2"><code class="java plain">{</code><code class="java keyword">if</code> <code class="java plain">isset($mbox-&gt;description)}</code></div><div class="line number6 index5 alt1"><code class="java spaces"> </code><code class="java plain">description {$mbox-&gt;description}</code></div><div class="line number7 index6 alt2"><code class="java plain">{/</code><code class="java keyword">if</code><code class="java plain">}</code></div><div class="line number8 index7 alt1"><code class="java plain">voicemail mailbox owner {$mbox-&gt;MBOX_USERNAME}</code></div><div class="line number9 index8 alt2"><code class="java plain">login pinless any-phone-number</code></div><div class="line number10 index9 alt1"><code class="java plain">end mailbox</code></div><div class="line number11 index10 alt2"><code class="java plain">{/foreach}</code></div><div class="line number12 index11 alt1"><code class="java plain">!</code></div></div></code></tr></tbody></table></div></div>
</div></div><p>Sometimes the line cannot be split, the solution is to either add a space character at the end of the line, if it remains correct for the configuration, or add an extra new line (one line left blank).</p>
<p>
  <a class="image-popup-fit-width" href="">
        <img alt="Image" src="images/FireShot_capture_-116.png" width="800"/></a>
</p>
<h3 id="MicroserviceTemplatingwithPHPSmarty-SyntaxErrors"><span class="">S</span><span class="">yntax Errors </span></h3><p>The Smarty syntax is very strict, for example an error in the template</p>
<p>
  <a class="image-popup-fit-width" href="">
        <img alt="Image" src="images/FireShot_capture_-118.png" width="800"/></a>
</p>
<p>will return</p><pre>Operation Failed
</pre><p>Currently, the only way to find the root cause is to check the file</p><pre>/opt/sms/logs/smsd.log
</pre><p>An example of an error found in the log</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_487039"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java value">2011</code><code class="java plain">/</code><code class="java value">08</code><code class="java plain">/</code><code class="java value">12</code><code class="java plain">:</code><code class="java value">12</code><code class="java plain">:</code><code class="java value">28</code><code class="java plain">:</code><code class="java value">42</code><code class="java plain">:(D):smsd:ZTD66206:JSCALLCOMMAND:: Managing object test</code></div><div class="line number2 index1 alt1"><code class="java value">2011</code><code class="java plain">/</code><code class="java value">08</code><code class="java plain">/</code><code class="java value">12</code><code class="java plain">:</code><code class="java value">12</code><code class="java plain">:</code><code class="java value">28</code><code class="java plain">:</code><code class="java value">42</code><code class="java plain">:(D):smsd:ZTD66206:JSCALLCOMMAND:: compute file /opt/fmc_repository/CommandDefinition/CISCO/MyTemplates/test.xml </code><code class="java keyword">for</code> <code class="java plain">key test</code></div><div class="line number3 index2 alt2"><code class="java value">2011</code><code class="java plain">/</code><code class="java value">08</code><code class="java plain">/</code><code class="java value">12</code><code class="java plain">:</code><code class="java value">12</code><code class="java plain">:</code><code class="java value">28</code><code class="java plain">:</code><code class="java value">42</code><code class="java plain">:(D):smsd:ZTD66206:JSCALLCOMMAND:: ELEMENT CREATE found</code></div><div class="line number4 index3 alt1"><code class="java value">2011</code><code class="java plain">/</code><code class="java value">08</code><code class="java plain">/</code><code class="java value">12</code><code class="java plain">:</code><code class="java value">12</code><code class="java plain">:</code><code class="java value">28</code><code class="java plain">:</code><code class="java value">42</code><code class="java plain">:(E):smsd:ZTD66206:JSCALLCOMMAND:: PHPERROR: [</code><code class="java value">256</code><code class="java plain">] Smarty error: [in var:2313098ec4aae945b1a201eb153cf778 line </code><code class="java value">3</code><code class="java plain">]: syntax error: </code><code class="java string">'if'</code> <code class="java plain">statement requires arguments (Smarty_Compiler.</code><code class="java keyword">class</code><code class="java plain">.php, line </code><code class="java value">1270</code><code class="java plain">) error on line </code><code class="java value">1093</code> <code class="java plain">in file /opt/sms/bin/php/smarty/Smarty.</code><code class="java keyword">class</code><code class="java plain">.php</code></div></div></code></tr></tbody></table></div></div>
</div></div><p>This indicates that in the file</p><pre>CommandDefinition/CISCO/MyTemplates/test.xml
</pre><p>for the command</p><pre>CREATE
</pre><p>an error occured in the 3rd line of the template</p><pre>syntax error: 'if' statement requires arguments
</pre><h3 id="MicroserviceTemplatingwithPHPSmarty-Usageofthe{$object_id}variable"><span class="">Usage of the {$object_id} variable </span></h3><p>The {$object_id} variable is used to reference objects into the database and is used as a variable name in Smarty in the template resolution.</p><p>When the parameters are passed to the engine you give:</p><pre>{"interface":{"Interface-Service-engine0/0":{"ip_address":"1.2.3.4"}}}
</pre><p>The variables values are:</p><pre>{$object_id} =&gt; <strong>"Interface-Service-engine0/0"</strong>
{$params.ip_address} =&gt; <strong>"1.2.3.4"</strong>
</pre><p>When writing a template <strong>{$object_id}</strong> can be used in expressions like <strong>{$interface.$object_id.ip_address}</strong> to retrieve database values.</p><p>The CREATE template looks like:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter xml" id="highlighter_287413"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">command</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"CREATE"</code><code class="xml plain">&gt;</code></div><div class="line number2 index1 alt1"><code class="xml spaces">    </code><code class="xml plain">&lt;</code><code class="xml keyword">operation</code><code class="xml plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="xml spaces">    </code><code class="xml color2">&lt;![CDATA[</code></div><div class="line number4 index3 alt1"><code class="xml color2">interface {$object_id}</code></div><div class="line number5 index4 alt2"><code class="xml color2">{if isset($params.dot1qtrunk) &amp;&amp; $params.dot1qtrunk == 'Yes'}</code></div><div class="line number6 index5 alt1"><code class="xml spaces"> </code><code class="xml color2">switchport trunk encapsulation dot1q</code></div><div class="line number7 index6 alt2"><code class="xml spaces"> </code><code class="xml color2">switchport mode trunk</code></div><div class="line number8 index7 alt1"><code class="xml color2">{/if}</code></div><div class="line number9 index8 alt2"><code class="xml color2">{if isset($params.vlan_id) &amp;&amp; $params.vlan_id != ''}</code></div><div class="line number10 index9 alt1"><code class="xml spaces"> </code><code class="xml color2">encapsulation dot1Q {$params.vlan_id} </code></div><div class="line number11 index10 alt2"><code class="xml color2">{/if}</code></div><div class="line number12 index11 alt1"><code class="xml color2">{if isset($params.ip_address) &amp;&amp; $params.ip_address != ''}</code></div><div class="line number13 index12 alt2"><code class="xml spaces"> </code><code class="xml color2">ip address {$params.ip_address} {$params.subnet_mask}  </code></div><div class="line number14 index13 alt1"><code class="xml color2">{/if}</code></div><div class="line number15 index14 alt2"><code class="xml color2">{if $object_id|stristr:"Ethernet" &amp;&amp; !$object_id|stristr:"."}</code></div><div class="line number16 index15 alt1"><code class="xml color2">{if isset($params.enable_nbar) &amp;&amp; $params.enable_nbar != '' &amp;&amp; $params.enable_nbar == 'Yes'}</code></div><div class="line number17 index16 alt2"><code class="xml spaces"> </code><code class="xml color2">ip nbar protocol-discovery </code></div><div class="line number18 index17 alt1"><code class="xml color2">{/if}</code></div><div class="line number19 index18 alt2"><code class="xml color2">{if isset($params.enable_media_type) &amp;&amp; $params.enable_media_type != '' &amp;&amp; $params.enable_media_type == 'Yes'}</code></div><div class="line number20 index19 alt1"><code class="xml spaces"> </code><code class="xml color2">max-reserved-bandwidth 100</code></div><div class="line number21 index20 alt2"><code class="xml spaces"> </code><code class="xml color2">media-type sfp </code></div><div class="line number22 index21 alt1"><code class="xml color2">{/if}</code></div><div class="line number23 index22 alt2"><code class="xml color2">{if isset($params.description) &amp;&amp; $params.description != ''}</code></div><div class="line number24 index23 alt1"><code class="xml spaces"> </code><code class="xml color2">description {$params.description} </code></div><div class="line number25 index24 alt2"><code class="xml color2">{/if}</code></div><div class="line number26 index25 alt1"><code class="xml color2">...</code></div><div class="line number27 index26 alt2"><code class="xml color2">no shutdown</code></div><div class="line number28 index27 alt1"><code class="xml color2">!]]&gt;</code></div><div class="line number29 index28 alt2"><code class="xml spaces">    </code><code class="xml plain">&lt;/</code><code class="xml keyword">operation</code><code class="xml plain">&gt;</code></div><div class="line number30 index29 alt1"><code class="xml plain">&lt;/</code><code class="xml keyword">command</code><code class="xml plain">&gt;</code></div></div></code></tr></tbody></table></div></div>
</div></div><p></p><p></p>




        </div>


        </div>