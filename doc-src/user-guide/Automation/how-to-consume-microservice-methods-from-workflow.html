<div class="documentation-content">

<div class="wiki-content" id="main-content">
                           
        <p>Thanks to the MSActivator's DevOps friendly nature, consuming these APIs (explained in <a href="../Configuration/Microservices/microservices-order-command-rest-api.adoc">Microservices Order Command REST API</a>) in Workflows will no longer be a pain point.</p><p>There are APIs ready to be consumed using simple PHP methods that are already implemented in the MSActivator library. There are two methods: one to consume the import method and the other to consume the remaining three methods.</p><h2 id="HowtoConsumeMicroserviceMethodsfromWorkflow-ConsumeIMPORTMethodfromWorkflow">Consume IMPORT Method from Workflow</h2><p>In the MSActivator repository, under <strong>Reference -&gt; Common → Library</strong>, there is a PHP file named "msa_common.php". In this file a method is implemented to invoke an import method of a Microservice definition. This definition is of a particular MSActivator device. More specifically:</p><ul><li>First, an empty array object has to be initialized in the PHP by using the "Microservice definition" name without the .xml (as explained in the http body of the api [root element name]).</li><li>Then invoke<span style="color: rgb(0,0,255);"><em> import_objects($msa_device_seq_num, $initialized_array)</em></span></li></ul><p>As an example, assume there is a Microservice definition to manage all VM instances on an OpenStack cloud with "servers.xml" as its name. To import all the instances of servers' Microservice definitions, do the following in the PHP implementation of the task:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter php" id="highlighter_104896"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="php variable">$arr</code><code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">(</code><code class="php string">"servers"</code><code class="php plain">);</code></div><div class="line number2 index1 alt1"><code class="php variable">$response</code> <code class="php plain">= import_objects(</code><code class="php variable">$openstack_device_id</code><code class="php plain">, </code><code class="php variable">$array</code><code class="php plain">);</code></div></div></code></tr></tbody></table></div></div>
</div></div><p><span style="color: rgb(0,0,255);"><em>$openstack_device_id</em> </span>is the numeric part of the MSActivator device ID, representing the OpenStack device in the MSActivator.</p><p>The <span style="color: rgb(0,0,255);"><em>$response</em></span> variable contains the encoded JSON object response, as mentioned in the http response in <a href="../Configuration/Microservices/microservices-order-command-rest-api.adoc">Microservices Order Command REST API</a>. For a more simplified usage of that encoded JSON, it can be decoded into an array variable in PHP, as shown below:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter php" id="highlighter_612484"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="php variable">$response</code> <code class="php plain">= json_decode(</code><code class="php variable">$response</code><code class="php plain">, true);</code></div><div class="line number2 index1 alt1"><code class="php spaces">    </code><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$response</code><code class="php plain">[</code><code class="php string">'wo_status'</code><code class="php plain">] !== ENDED) {</code></div><div class="line number3 index2 alt2"><code class="php spaces">        </code><code class="php comments">//There is some error while executing import_objects() library method, hence the 'wo_status' value is not "ENDED"</code></div><div class="line number4 index3 alt1"><code class="php spaces">        </code><code class="php variable">$response</code> <code class="php plain">= json_encode(</code><code class="php variable">$response</code><code class="php plain">);</code></div><div class="line number5 index4 alt2"><code class="php spaces">        </code><code class="php keyword">return</code> <code class="php variable">$response</code><code class="php plain">;</code></div><div class="line number6 index5 alt1"><code class="php spaces">    </code><code class="php plain">}</code></div><div class="line number7 index6 alt2"><code class="php comments">//The response in now decoded into array variable, now extract the interested section of the array</code></div><div class="line number8 index7 alt1"><code class="php variable">$servers</code> <code class="php plain">= </code><code class="php variable">$response</code><code class="php plain">[</code><code class="php string">'wo_newparams'</code><code class="php plain">][</code><code class="php string">"servers"</code><code class="php plain">];</code></div></div></code></tr></tbody></table></div></div>
</div></div><p>The <span style="color: rgb(0,0,255);"><em>$servers</em></span> array can now be accessed/iterated as shown below:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter php" id="highlighter_106795"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="php keyword">foreach</code> <code class="php plain">(</code><code class="php variable">$servers</code> <code class="php keyword">as</code> <code class="php variable">$server_object_id</code> <code class="php plain">=&gt; </code><code class="php variable">$server_params</code><code class="php plain">) {</code></div><div class="line number2 index1 alt1"><code class="php comments">//for each servers instance extract instance variables, for example is name is an instance variable in servers microservice</code></div><div class="line number3 index2 alt2"><code class="php spaces">        </code><code class="php variable">$name</code> <code class="php plain">= </code><code class="php variable">$server_params</code><code class="php plain">[</code><code class="php string">'name'</code><code class="php plain">];</code></div><div class="line number4 index3 alt1"><code class="php plain">}</code></div></div></code></tr></tbody></table></div></div>
</div></div><h2 id="HowtoConsumeMicroserviceMethodsfromWorkflow-ConsumeUPDATE/CREATE/DELETEMethodsofMicroservicesfromWorkflow">Consume UPDATE/CREATE/DELETE Methods of Microservices from Workflow</h2><p>Under <strong>Reference -&gt; Common -&gt; Library</strong> in the MSActivator repository, there is a PHP file with name <strong>msa_common.php</strong>. In this file a method is implemented to consume the remaining methods of Microservices.</p><p><span style="color: rgb(0,0,255);"><em>execute_command_and_verify_response ($device_id, $command_name, $object_parameters, $comment, $connection_timeout = 60, $max_time = 60).</em></span></p><p>Where: <span style="color: rgb(0,0,255);"><em>$device_id</em></span> : is the numeric part of the MSActivator device ID on which you need to invoke microservice methods.<span style="color: rgb(0,0,255);"><em>$command_name </em></span>: is the same as the {commandName} mentioned in <a href="../Configuration/Microservices/microservices-order-command-rest-api.adoc">How to Manage Microservices from REST API<span style="color: rgb(0,16,0);">.</span></a> <span style="color: rgb(0,0,255);"><em>$object_parameters</em> </span>: is the decoded JSON object in PHP array variable.</p><p>For example, if the http body has to have the following JSON data:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter php" id="highlighter_224553"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="php plain">{</code><code class="php string">'address_ip_netmask'</code><code class="php plain">:{</code></div><div class="line number2 index1 alt1"><code class="php spaces">    </code><code class="php plain">first_address":{</code></div><div class="line number3 index2 alt2"><code class="php spaces">        </code><code class="php string">"address"</code><code class="php plain">:</code><code class="php string">"10.20.30.40"</code><code class="php plain">,</code></div><div class="line number4 index3 alt1"><code class="php spaces">        </code><code class="php string">"masklen"</code><code class="php plain">:</code><code class="php string">"2"</code></div><div class="line number5 index4 alt2"><code class="php spaces">        </code><code class="php plain">}</code></div><div class="line number6 index5 alt1"><code class="php spaces">    </code><code class="php plain">}</code></div><div class="line number7 index6 alt2"><code class="php plain">}</code></div></div></code></tr></tbody></table></div></div>
</div></div><p>The equivalent $object_parameters will have to be defined such as in the following in PHP:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter php" id="highlighter_399679"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="php variable">$object_parameters</code> <code class="php plain">= </code><code class="php keyword">array</code><code class="php plain">(</code><code class="php string">'address_ip_netmask'</code> <code class="php plain">=&gt;                </code></div><div class="line number2 index1 alt1"><code class="php spaces">    </code><code class="php keyword">array</code><code class="php plain">(</code><code class="php string">"first_address"</code> <code class="php plain">=&gt;</code></div><div class="line number3 index2 alt2"><code class="php spaces">        </code><code class="php keyword">array</code><code class="php plain">(</code><code class="php string">'address'</code> <code class="php plain">=&gt; </code><code class="php string">"10.20.30.40"</code><code class="php plain">,</code></div><div class="line number4 index3 alt1"><code class="php spaces">              </code><code class="php string">'masklen'</code> <code class="php plain">=&gt; </code><code class="php string">"24"</code></div><div class="line number5 index4 alt2"><code class="php spaces">             </code><code class="php plain">)</code></div><div class="line number6 index5 alt1"><code class="php spaces">         </code><code class="php plain">)</code></div><div class="line number7 index6 alt2"><code class="php spaces">     </code><code class="php plain">);</code></div></div></code></tr></tbody></table></div></div>
</div></div><p>Then, invoke the method in the PHP implementation of the task as shown below:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter php" id="highlighter_575525"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="php variable">$response</code> <code class="php plain">= execute_command_and_verify_response(</code><code class="php variable">$device_id</code><code class="php plain">, </code><code class="php string">'CREATE'</code><code class="php plain">, </code><code class="php variable">$object_parameters</code><code class="php plain">, </code><code class="php string">"CREATE IP NETMASK"</code><code class="php plain">, 180, 180);</code></div></div></code></tr></tbody></table></div></div>
</div></div><p></p>

                
        
    
        </div>

        </div>