<div class="documentation-content">

<div class="wiki-content" id="main-content">
                           
        <p>Before we deal with how to invoke the processes of Workflows, we need to attach a Workflow definition to a customer in MSActivator.</p><p>First, we will look into how to attach a Workflow definition to a customer.</p><h2 id="WorkflowRESTAPIandFunctionLibrary-PrerequisitesforWorkflowProcess"><strong>Prerequisites for Workflow Process</strong></h2><p>If a Workflow needs to be invoked from a portal and REST API in the command line, the Workflow needs to include some extra code.</p><p>Basically, when you invoke the Workflow from the UI Portal, all the parameters go into the $context. But, when you invoke the Workflow from the command line using REST APIs, all the input parameters go into the $parameters. </p><p>Orchestration only considers the parameters set in $context. So, all the parameters provided through the command line will go into $parameters and will not be considered for the execution. Rather, previously saved parameters will be used. </p><p></p><p>If someone intends a Workflow to be invoked from both the UI and command line, the Workflow should have some code which will copy the parameters from $parameters to $context. Following is the code that has to be in the first task of the process that will be invoked from an API call:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter php" id="highlighter_631152"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="php keyword">if</code><code class="php plain">(isset(</code><code class="php variable">$parameters</code><code class="php plain">) ){</code></div><div class="line number2 index1 alt1"><code class="php spaces">    </code><code class="php variable">$context</code><code class="php plain">[</code><code class="php string">'&lt;param_name_1&gt;'</code><code class="php plain">] = </code><code class="php variable">$parameters</code><code class="php plain">[</code><code class="php string">'&lt;param_name_1&gt;'</code><code class="php plain">];</code></div><div class="line number3 index2 alt2"><code class="php spaces">    </code><code class="php variable">$context</code><code class="php plain">[</code><code class="php string">'&lt;param_name_2&gt;'</code><code class="php plain">] = </code><code class="php variable">$parameters</code><code class="php plain">[</code><code class="php string">'&lt;param_name_2&gt;'</code><code class="php plain">];</code></div><div class="line number4 index3 alt1"><code class="php spaces">   </code><code class="php plain">......</code></div><div class="line number5 index4 alt2"><code class="php spaces">   </code><code class="php plain">....</code></div><div class="line number6 index5 alt1"><code class="php spaces"> </code><code class="php plain">}</code></div></div></code></tr></tbody></table></div></div>
</div></div><h2 id="WorkflowRESTAPIandFunctionLibrary-AttachaWorkflowDefinitiontoaCustomer:"><strong>Attach a Workflow Definition to a Customer:</strong></h2><h3 id="WorkflowRESTAPIandFunctionLibrary-NorthboundAPI">Northbound API</h3><p>MSActivator has a northbound API to attach a Workflow definition to a customer:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_853804"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">http:</code><code class="java comments">//{$MSA_IP}/orchestration/{$ubiqube_id}/service/attach?uri={$service_uri}</code></div><div class="line number2 index1 alt1"><code class="java plain">HTTP method: POST</code></div></div></code></tr></tbody></table></div></div>
</div></div><p>Where:</p><p>{$MSA_IP} corresponds to the IP address of the MSActivator. </p><p>{$ubiqube_id} corresponds to the customer id of the MSActivator including the prefix, for example UBIA234.</p><p>{$service_uri} corresponds to the relative path of the XML file of the Workflow definition in MSActivator repository. The relative path starts from "Process/......" and includes the .xml at the end.</p><h3 id="WorkflowRESTAPIandFunctionLibrary-PHPLibraryFunctionforTasks">PHP Library Function for Tasks</h3><p>The PHP function is available in the MSActivator library of the PHP methods to consume this API in the file "Process/Reference/Common/Library/orchestration_rest.php". The method to use in this file is:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_67895"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">_orchestration_service_attach ($ubiqube_id, $service_uri);</code></div></div></code></tr></tbody></table></div></div>
</div></div><p>The $ubiqube_id and $service_uri correspond to the same as explained in the API.</p><h2 id="WorkflowRESTAPIandFunctionLibrary-InvokeaCreateProcessofaWorkflow">Invoke a Create Process of a Workflow</h2><h3 id="WorkflowRESTAPIandFunctionLibrary-NorthboundAPI.1">Northbound API</h3><p>To call the create process of a Workflow under a customer with the goal of creating a new instance of the Workflow, the following API is available:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_361854"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">URL: </code></div><div class="line number2 index1 alt1"><code class="java plain">http:</code><code class="java comments">//{$MSA_IP}/ubi-api-rest/orchestration/service/execute/{$external_ref}/{$service_external_ref}?serviceName={$service_name}&amp;processName={$process_name}</code></div><div class="line number3 index2 alt2"><code class="java plain">HTTP method: POST</code></div></div></code></tr></tbody></table></div></div>
</div></div><p>Where:{$external_ref} corresponds to the MSActivator customer external reference.</p><p>{$service_external_ref} corresponds to the MSActivator Workflow instance external reference to the newly created instance. Note that it has to be unique (duplicates are not allowed).{$service_name} corresponds to the service name/URI which is the relative path of the Workflow definition, excluding the .xml starting from the "Process/..." in the fmc_repository.{$process_name} is the process name defined in the XML definition of the Workflow. FYI the XML definition can be downloaded from the MSActivator repository web GUI.For input parameters that are required for the Workflow, the HTTP body has to be a JSON format string containing a variable: value pairs, for example. If triggering the create process of a Workflow, it requires following two variable-value pairs to be instantiated:</p><ul><li>management_ip : 10.30.18.40</li><li>management_interface: Loopback0</li></ul><p>The HTTP body to the above API should be as follows:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_414845"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">{ </code><code class="java string">"management_ip"</code> <code class="java plain">: </code><code class="java string">"10.30.18.40"</code><code class="java plain">, </code><code class="java string">"management_interface"</code> <code class="java plain">: </code><code class="java string">"Loopback0"</code><code class="java plain">}</code></div></div></code></tr></tbody></table></div></div>
</div></div><p>This API, if successful, returns a JSON object containing the triggered process details (like processId and so on), Workflow instance details (line serviceId, serviceExternalreference etc.), and the status details of the triggered process. The actual JSON structure can be found in the example below:</p><h3 id="WorkflowRESTAPIandFunctionLibrary-Examplewithcurl">Example with curl</h3><p>Consider we want to trigger a create process: "<strong>Process/MSA/FortiHypervisor/Fortinet_Selfcare/Process_Create</strong>" (process name) of the Workflow: "<strong>Process/MSA/FortiHypervisor/Fortinet_Selfcare/Fortinet_Selfcare</strong>" (service name) under a customer with customer external reference: <strong>MSSA34</strong>. The Worklfow/service instance external reference string "<strong>My_New_Instance</strong>" provided, will be unique, as long as the create process needs the following variable-value inputs:  "admin_customer_ref": "MSAA12" and "device": "test_device".</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_395293"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">/usr/bin/curl -isw </code><code class="java string">'HTTP_CODE=%{http_code}'</code> <code class="java plain">-u </code></div><div class="line number2 index1 alt1"><code class="java plain">&lt;USERNAME&gt;:&lt;PASSWORD&gt; --connect-timeout </code><code class="java value">60</code> <code class="java plain">--max-time </code><code class="java value">60</code> <code class="java plain">-H </code></div><div class="line number3 index2 alt2"><code class="java string">"Content-Type: application/json"</code> <code class="java plain">-X POST </code><code class="java string">'<a href="http://127.0.0.1:80/ubi-api-rest/orchestration/service/execute/MSSA34/My_New_Instance?serviceName=Process/MSS/Selfcare&amp;processName=Process/MSS/Process_Create'">http://127.0.0.1:80/ubi-api-rest/orchestration/service/execute/MSSA34/My_New_Instance?serviceName=Process/MSS/Selfcare&amp;processName=Process/MSS/Process_Create'</a></code> <code class="java plain">-d '{</code></div><div class="line number4 index3 alt1"><code class="java spaces">        </code><code class="java string">"admin_customer_ref"</code><code class="java plain">: </code><code class="java string">"MSSA12"</code><code class="java plain">,</code></div><div class="line number5 index4 alt2"><code class="java spaces">        </code><code class="java string">"device"</code><code class="java plain">: </code><code class="java string">"test_device"</code></div><div class="line number6 index5 alt1"><code class="java plain">}'</code></div></div></code></tr></tbody></table></div></div>
</div></div><p>&lt;USERNAME&gt; and &lt;PASSWORD&gt; to be replaced with MSActivator user credentials.</p><p>serviceName and processName are in URL encoded form.</p><p><strong>Note</strong>: In this example, "service external reference" (optional) is not provided, hence it is auto-generated in the format <strong>&lt;Operator_prefix&gt;SID&lt;Service_Instance_id&gt;</strong> for ex. MSASID6608.</p><p>The API response would be:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_131037"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">Curl Response :</code></div><div class="line number2 index1 alt1"><code class="java plain">HTTP/</code><code class="java value">1.1</code> <code class="java value">200</code> <code class="java plain">OK</code></div><div class="line number3 index2 alt2"><code class="java plain">Date: Thu, </code><code class="java value">06</code> <code class="java plain">Sep </code><code class="java value">2018</code> <code class="java value">10</code><code class="java plain">:</code><code class="java value">39</code><code class="java plain">:</code><code class="java value">40</code> <code class="java plain">GMT</code></div><div class="line number4 index3 alt1"><code class="java plain">Server: Apache</code></div><div class="line number5 index4 alt2"><code class="java plain">Content-Length: </code><code class="java value">628</code></div><div class="line number6 index5 alt1"><code class="java plain">Content-Type: application/json</code></div><div class="line number7 index6 alt2"> </div><div class="line number8 index7 alt1"><code class="java plain">{</code></div><div class="line number9 index8 alt2"><code class="java spaces">        </code><code class="java string">"processId"</code><code class="java plain">: {</code></div><div class="line number10 index9 alt1"><code class="java spaces">                </code><code class="java string">"id"</code><code class="java plain">: </code><code class="java value">12918</code><code class="java plain">,</code></div><div class="line number11 index10 alt2"><code class="java spaces">                </code><code class="java string">"lastExecNumber"</code><code class="java plain">: </code><code class="java value">1</code><code class="java plain">,</code></div><div class="line number12 index11 alt1"><code class="java spaces">                </code><code class="java string">"name"</code><code class="java plain">: </code><code class="java string">"Process/MSActivator/FortiHypervisor/Fortinet_Selfcare/Process_Create"</code><code class="java plain">,</code></div><div class="line number13 index12 alt2"><code class="java spaces">                </code><code class="java string">"submissionType"</code><code class="java plain">: </code><code class="java string">"RUN"</code></div><div class="line number14 index13 alt1"><code class="java spaces">        </code><code class="java plain">},</code></div><div class="line number15 index14 alt2"><code class="java spaces">        </code><code class="java string">"serviceId"</code><code class="java plain">: {</code></div><div class="line number16 index15 alt1"><code class="java spaces">                </code><code class="java string">"id"</code><code class="java plain">: </code><code class="java value">6608</code><code class="java plain">,</code></div><div class="line number17 index16 alt2"><code class="java spaces">                </code><code class="java string">"name"</code><code class="java plain">: </code><code class="java string">"Process/MSA/FortiHypervisor/Fortinet_Selfcare/Fortinet_Selfcare"</code><code class="java plain">,</code></div><div class="line number18 index17 alt1"><code class="java spaces">                </code><code class="java string">"serviceExternalReference"</code><code class="java plain">: </code><code class="java string">"My_New_Instance"</code><code class="java plain">,</code></div><div class="line number19 index18 alt2"><code class="java spaces">                </code><code class="java string">"state"</code><code class="java plain">: </code><code class="java keyword">null</code></div><div class="line number20 index19 alt1"><code class="java spaces">        </code><code class="java plain">},</code></div><div class="line number21 index20 alt2"><code class="java spaces">        </code><code class="java string">"status"</code><code class="java plain">: {</code></div><div class="line number22 index21 alt1"><code class="java spaces">                </code><code class="java string">"details"</code><code class="java plain">: </code><code class="java string">""</code><code class="java plain">,</code></div><div class="line number23 index22 alt2"><code class="java spaces">                </code><code class="java string">"endingDate"</code><code class="java plain">: </code><code class="java keyword">null</code><code class="java plain">,</code></div><div class="line number24 index23 alt1"><code class="java spaces">                </code><code class="java string">"execNumber"</code><code class="java plain">: </code><code class="java value">1</code><code class="java plain">,</code></div><div class="line number25 index24 alt2"><code class="java spaces">                </code><code class="java string">"processTaskStatus"</code><code class="java plain">: [</code></div><div class="line number26 index25 alt1"><code class="java spaces">                        </code><code class="java plain">{</code></div><div class="line number27 index26 alt2"><code class="java spaces">                                </code><code class="java string">"details"</code><code class="java plain">: </code><code class="java string">""</code><code class="java plain">,</code></div><div class="line number28 index27 alt1"><code class="java spaces">                                </code><code class="java string">"endingDate"</code><code class="java plain">: </code><code class="java string">""</code><code class="java plain">,</code></div><div class="line number29 index28 alt2"><code class="java spaces">                                </code><code class="java string">"newParameter"</code><code class="java plain">: [</code></div><div class="line number30 index29 alt1"><code class="java spaces">                                </code><code class="java plain">],</code></div><div class="line number31 index30 alt2"><code class="java spaces">                                </code><code class="java string">"order"</code><code class="java plain">: </code><code class="java value">1</code><code class="java plain">,</code></div><div class="line number32 index31 alt1"><code class="java spaces">                                </code><code class="java string">"processInstanceId"</code><code class="java plain">: </code><code class="java value">12918</code><code class="java plain">,</code></div><div class="line number33 index32 alt2"><code class="java spaces">                                </code><code class="java string">"scriptName"</code><code class="java plain">: </code><code class="java string">"Enable Selfcare for FortiHypervisor"</code><code class="java plain">,</code></div><div class="line number34 index33 alt1"><code class="java spaces">                                </code><code class="java string">"startingDate"</code><code class="java plain">: </code><code class="java string">"2018-09-06 10:39:41.06031"</code><code class="java plain">,</code></div><div class="line number35 index34 alt2"><code class="java spaces">                                </code><code class="java string">"status"</code><code class="java plain">: </code><code class="java string">"RUNNING"</code></div><div class="line number36 index35 alt1"><code class="java spaces">                        </code><code class="java plain">}</code></div><div class="line number37 index36 alt2"><code class="java spaces">                </code><code class="java plain">],</code></div><div class="line number38 index37 alt1"><code class="java spaces">                </code><code class="java string">"startingDate"</code><code class="java plain">: </code><code class="java string">"2018-09-06 10:39:41.006798"</code><code class="java plain">,</code></div><div class="line number39 index38 alt2"><code class="java spaces">                </code><code class="java string">"status"</code><code class="java plain">: </code><code class="java string">"RUNNING"</code></div><div class="line number40 index39 alt1"><code class="java spaces">        </code><code class="java plain">}</code></div><div class="line number41 index40 alt2"><code class="java plain">}</code></div></div></code></tr></tbody></table></div></div>
</div></div><p></p><h3 id="WorkflowRESTAPIandFunctionLibrary-PHPlibraryfunctionforTasks">PHP library function for Tasks</h3><p></p><p>In the MSA, to invoke an API, a library PHP function is available. This API is defined in this type of file: "Process/Reference/Common/Library/orchestration_rest.php":</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_912437"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">_orchestration_execute_service_by_reference ($external_ref, $service_ref, $service_name, $process_name, $json_body = </code><code class="java string">"{}"</code><code class="java plain">);</code></div></div></code></tr></tbody></table></div></div>
</div></div><p>The parameters are the same as explained in the API above. The <strong>$json_body</strong> corresponds to the string that is mentioned in the HTTP body section of the API.</p><p>The returned response of the API needs to be assigned to a PHP variable and then accessed.</p><p></p><h4 id="WorkflowRESTAPIandFunctionLibrary-ExampleofthePHPfunctionusage:">Example of the PHP function usage:</h4><p>If the above API example was done using this PHP method, the following would be the PHP code snippet of the PHP task implementation to trigger and access the response:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter php" id="highlighter_897567"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="php variable">$process_name</code><code class="php plain">=</code><code class="php string">"Process/MSA/Helloworld/Process_create_instance"</code><code class="php plain">;</code></div><div class="line number2 index1 alt1"><code class="php variable">$service_name</code><code class="php plain">=</code><code class="php string">"Process/MSA/Helloworld"</code><code class="php plain">;</code></div><div class="line number3 index2 alt2"><code class="php variable">$json_body</code><code class="php plain">=</code><code class="php string">"{}"</code><code class="php plain">;</code></div><div class="line number4 index3 alt1"><code class="php variable">$external_ref</code><code class="php plain">=</code><code class="php string">"MSSA34"</code><code class="php plain">;</code></div><div class="line number5 index4 alt2"><code class="php variable">$response</code> <code class="php plain">= _orchestration_execute_service_by_reference (</code><code class="php variable">$external_ref</code><code class="php plain">, </code><code class="php string">"My_New_Instance"</code><code class="php plain">, </code><code class="php variable">$service_name</code><code class="php plain">, </code><code class="php variable">$process_name</code><code class="php plain">, </code><code class="php variable">$json_body</code><code class="php plain">);</code></div><div class="line number6 index5 alt1"> </div><div class="line number7 index6 alt2"><code class="php comments">//Now the returned info is accessed using the $response variable as shown below:</code></div><div class="line number8 index7 alt1"><code class="php comments">//Decode the json string into objects</code></div><div class="line number9 index8 alt2"><code class="php variable">$response</code> <code class="php plain">= json_decode(</code><code class="php variable">$response</code><code class="php plain">, true);</code></div><div class="line number10 index9 alt1"><code class="php keyword">if</code> <code class="php plain">(</code><code class="php variable">$response</code><code class="php plain">[</code><code class="php string">'wo_status'</code><code class="php plain">] !== ENDED) {</code></div><div class="line number11 index10 alt2"><code class="php spaces">    </code><code class="php plain">task_exit(FAILED, </code><code class="php string">"Service $service_name execution failed.\n"</code> <code class="php plain">. </code><code class="php variable">$response</code><code class="php plain">[</code><code class="php string">'wo_comment'</code><code class="php plain">]);</code></div><div class="line number12 index11 alt1"><code class="php plain">}</code></div><div class="line number13 index12 alt2"><code class="php variable">$selfcare_instance_id</code><code class="php plain">=</code><code class="php variable">$response</code><code class="php plain">[</code><code class="php string">'wo_newparams'</code><code class="php plain">][</code><code class="php string">'serviceId'</code><code class="php plain">][</code><code class="php string">'id'</code><code class="php plain">];</code></div><div class="line number14 index13 alt1"><code class="php comments">//As per the above response, the $selfcare_instance_id would now have the value 6608</code></div><div class="line number15 index14 alt2"><code class="php variable">$selfcare_instance_ref</code><code class="php plain">=</code><code class="php variable">$response</code><code class="php plain">[</code><code class="php string">'wo_newparams'</code><code class="php plain">][</code><code class="php string">'serviceId'</code><code class="php plain">][</code><code class="php string">'serviceExternalReference'</code><code class="php plain">];</code></div><div class="line number16 index15 alt1"><code class="php comments">//As per the above response, the $selfcare_instance_ref would now have the value "My_New_Instance"</code></div></div></code></tr></tbody></table></div></div>
</div></div><h2 id="WorkflowRESTAPIandFunctionLibrary-TriggeranUPDATEorDELETEprocessofaWorkflow">Trigger an UPDATE or DELETE process of a Workflow</h2><h3 id="WorkflowRESTAPIandFunctionLibrary-NorthboundAPI.2">Northbound API</h3><p>When invoking the UPDATE or DELETE process of a Workflow instance, the API is the same as for the CREATE.</p><p></p><p><span style="font-size: 16.0px;font-weight: bold;">Curl example:</span></p><p>We wish to trigger an update process "Process/MSA/FortiHypervisor/Fortinet_Selfcare/Process_Update" (process name) of the Workflow "Process/MSA/FortiHypervisor/Fortinet_Selfcare/Fortinet_Selfcare" (service name). This is for the Workflow instance identified by the service external reference with the value MSASID6608, which is under a customer with customer external reference: MSSA34. This is provided that the create process needs the following variable-value inputs: </p><ul><li>"name": "John"</li><li>"device": "test_device".</li></ul><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_517506"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">/usr/bin/curl -isw </code><code class="java string">'HTTP_CODE=%{http_code}'</code> <code class="java plain">-u </code></div><div class="line number2 index1 alt1"><code class="java plain">&lt;USERNAME&gt;:&lt;PASSWORD&gt; --connect-timeout </code><code class="java value">60</code> <code class="java plain">--max-time </code><code class="java value">60</code> <code class="java plain">-H </code></div><div class="line number3 index2 alt2"><code class="java string">"Content-Type: application/json"</code> <code class="java plain">-X POST </code><code class="java string">'<a href="http://127.0.0.1:80/ubi-api-rest/orchestration/service/execute/MSSA34/MSASID6608?serviceName=Process%2FMSA%2FHelloworld&amp;processName=Process%2FMSA%2FHelloworld%2FProcess_print_message'">http://127.0.0.1:80/ubi-api-rest/orchestration/service/execute/MSSA34/MSASID6608?serviceName=Process%2FMSA%2FHelloworld&amp;processName=Process%2FMSA%2FHelloworld%2FProcess_print_message'</a></code> <code class="java plain">-d '{</code></div><div class="line number4 index3 alt1"><code class="java spaces">        </code><code class="java string">"name"</code><code class="java plain">: </code><code class="java string">"John"</code></div><div class="line number5 index4 alt2"><code class="java plain">}'</code></div></div></code></tr></tbody></table></div></div>
</div></div><p>The API response would be:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_847683"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">Curl Response :</code></div><div class="line number2 index1 alt1"><code class="java plain">HTTP/</code><code class="java value">1.1</code> <code class="java value">200</code> <code class="java plain">OK</code></div><div class="line number3 index2 alt2"><code class="java plain">Date: Thu, </code><code class="java value">06</code> <code class="java plain">Sep </code><code class="java value">2018</code> <code class="java value">10</code><code class="java plain">:</code><code class="java value">39</code><code class="java plain">:</code><code class="java value">40</code> <code class="java plain">GMT</code></div><div class="line number4 index3 alt1"><code class="java plain">Server: Apache</code></div><div class="line number5 index4 alt2"><code class="java plain">Content-Length: </code><code class="java value">628</code></div><div class="line number6 index5 alt1"><code class="java plain">Content-Type: application/json</code></div><div class="line number7 index6 alt2"> </div><div class="line number8 index7 alt1"> </div><div class="line number9 index8 alt2"><code class="java plain">{</code></div><div class="line number10 index9 alt1"><code class="java spaces">        </code><code class="java string">"processId"</code><code class="java plain">: {</code></div><div class="line number11 index10 alt2"><code class="java spaces">                </code><code class="java string">"id"</code><code class="java plain">: </code><code class="java value">12919</code><code class="java plain">,</code></div><div class="line number12 index11 alt1"><code class="java spaces">                </code><code class="java string">"lastExecNumber"</code><code class="java plain">: </code><code class="java value">1</code><code class="java plain">,</code></div><div class="line number13 index12 alt2"><code class="java spaces">                </code><code class="java string">"name"</code><code class="java plain">: </code><code class="java string">"Process/MSA/Helloworld/Process_print_message"</code><code class="java plain">,</code></div><div class="line number14 index13 alt1"><code class="java spaces">                </code><code class="java string">"submissionType"</code><code class="java plain">: </code><code class="java string">"RUN"</code></div><div class="line number15 index14 alt2"><code class="java spaces">        </code><code class="java plain">},</code></div><div class="line number16 index15 alt1"><code class="java spaces">        </code><code class="java string">"serviceId"</code><code class="java plain">: {</code></div><div class="line number17 index16 alt2"><code class="java spaces">                </code><code class="java string">"id"</code><code class="java plain">: </code><code class="java value">6608</code><code class="java plain">,</code></div><div class="line number18 index17 alt1"><code class="java spaces">                </code><code class="java string">"name"</code><code class="java plain">: </code><code class="java string">"Process/MSA/Helloworld"</code><code class="java plain">,</code></div><div class="line number19 index18 alt2"><code class="java spaces">                </code><code class="java string">"serviceExternalReference"</code><code class="java plain">: </code><code class="java string">"MSASID6608"</code><code class="java plain">,</code></div><div class="line number20 index19 alt1"><code class="java spaces">                </code><code class="java string">"state"</code><code class="java plain">: </code><code class="java keyword">null</code></div><div class="line number21 index20 alt2"><code class="java spaces">        </code><code class="java plain">},</code></div><div class="line number22 index21 alt1"><code class="java spaces">        </code><code class="java string">"status"</code><code class="java plain">: {</code></div><div class="line number23 index22 alt2"><code class="java spaces">                </code><code class="java string">"details"</code><code class="java plain">: </code><code class="java string">""</code><code class="java plain">,</code></div><div class="line number24 index23 alt1"><code class="java spaces">                </code><code class="java string">"endingDate"</code><code class="java plain">: </code><code class="java keyword">null</code><code class="java plain">,</code></div><div class="line number25 index24 alt2"><code class="java spaces">                </code><code class="java string">"execNumber"</code><code class="java plain">: </code><code class="java value">1</code><code class="java plain">,</code></div><div class="line number26 index25 alt1"><code class="java spaces">                </code><code class="java string">"processTaskStatus"</code><code class="java plain">: [</code></div><div class="line number27 index26 alt2"><code class="java spaces">                        </code><code class="java plain">{</code></div><div class="line number28 index27 alt1"><code class="java spaces">                                </code><code class="java string">"details"</code><code class="java plain">: </code><code class="java string">""</code><code class="java plain">,</code></div><div class="line number29 index28 alt2"><code class="java spaces">                                </code><code class="java string">"endingDate"</code><code class="java plain">: </code><code class="java string">""</code><code class="java plain">,</code></div><div class="line number30 index29 alt1"><code class="java spaces">                                </code><code class="java string">"newParameter"</code><code class="java plain">: [</code></div><div class="line number31 index30 alt2"><code class="java spaces">                                </code><code class="java plain">],</code></div><div class="line number32 index31 alt1"><code class="java spaces">                                </code><code class="java string">"order"</code><code class="java plain">: </code><code class="java value">1</code><code class="java plain">,</code></div><div class="line number33 index32 alt2"><code class="java spaces">                                </code><code class="java string">"processInstanceId"</code><code class="java plain">: </code><code class="java value">12919</code><code class="java plain">,</code></div><div class="line number34 index33 alt1"><code class="java spaces">                                </code><code class="java string">"scriptName"</code><code class="java plain">: </code><code class="java string">"Task print"</code><code class="java plain">,</code></div><div class="line number35 index34 alt2"><code class="java spaces">                                </code><code class="java string">"startingDate"</code><code class="java plain">: </code><code class="java string">"2018-09-06 10:39:41.06031"</code><code class="java plain">,</code></div><div class="line number36 index35 alt1"><code class="java spaces">                                </code><code class="java string">"status"</code><code class="java plain">: </code><code class="java string">"RUNNING"</code></div><div class="line number37 index36 alt2"><code class="java spaces">                        </code><code class="java plain">}</code></div><div class="line number38 index37 alt1"><code class="java spaces">                </code><code class="java plain">],</code></div><div class="line number39 index38 alt2"><code class="java spaces">                </code><code class="java string">"startingDate"</code><code class="java plain">: </code><code class="java string">"2018-09-06 10:39:41.006798"</code><code class="java plain">,</code></div><div class="line number40 index39 alt1"><code class="java spaces">                </code><code class="java string">"status"</code><code class="java plain">: </code><code class="java string">"RUNNING"</code></div><div class="line number41 index40 alt2"><code class="java spaces">        </code><code class="java plain">}</code></div><div class="line number42 index41 alt1"><code class="java plain">}</code></div></div></code></tr></tbody></table></div></div>
</div></div><h3 id="WorkflowRESTAPIandFunctionLibrary-PHPlibraryfunctionforTasks.1">PHP library function for Tasks</h3><p>In the MSA, to invoke an API, a library PHP function is available. This API is defined in this type of file: "Process/Reference/Common/Library/orchestration_rest.php":</p><p>Where parameters are the same as explained in the API above. The <strong>$json_body</strong> corresponds to the string that is mentioned in the HTTP body section of the API.</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter java" id="highlighter_863616"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">_orchestration_execute_service_by_reference ($external_ref, $service_ref, $service_name, $process_name, $json_body = </code><code class="java string">"{}"</code><code class="java plain">);</code></div></div></code></tr></tbody></table></div></div>
</div></div><p></p><h4 id="WorkflowRESTAPIandFunctionLibrary-ExampleofthePHPfunctionusage:.1">Example of the PHP function usage:</h4><p>If the above API example was done using this PHP method, the PHP code snippet of the PHP implementation of the task to trigger and access the response would be as follows:</p><div class="code panel pdl conf-macro output-block" data-hasbody="true" data-macro-name="code" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div class="syntaxhighlighter sh-confluence nogutter php" id="highlighter_737232"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><code class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="php variable">$process_name</code><code class="php plain">=</code><code class="php string">"Process/MSA/FortiHypervisor/Fortinet_Selfcare/Process_Update"</code><code class="php plain">;</code></div><div class="line number2 index1 alt1"><code class="php variable">$service_name</code><code class="php plain">=</code><code class="php string">"Process/MSA/FortiHypervisor/Fortinet_Selfcare/Fortinet_Selfcare"</code><code class="php plain">;</code></div><div class="line number3 index2 alt2"><code class="php variable">$json_body</code><code class="php plain">=</code><code class="php string">"{'admin_customer_ref': 'MSAA12','device': 'test_device'}"</code><code class="php plain">;</code></div><div class="line number4 index3 alt1"><code class="php variable">$external_ref</code><code class="php plain">=</code><code class="php string">"MSSA34"</code><code class="php plain">;</code></div><div class="line number5 index4 alt2"><code class="php variable">$service_ref</code><code class="php plain">=</code><code class="php string">"MSASID6608"</code><code class="php plain">;</code></div><div class="line number6 index5 alt1"><code class="php variable">$response</code> <code class="php plain">= _orchestration_execute_service_by_reference (</code><code class="php variable">$external_ref</code><code class="php plain">, </code><code class="php variable">$service_ref</code><code class="php plain">, </code><code class="php variable">$service_name</code><code class="php plain">, </code><code class="php variable">$process_name</code><code class="php plain">, </code><code class="php variable">$json_body</code><code class="php plain">);</code></div></div></code></tr></tbody></table></div></div>
</div></div><p></p><p></p>

                
        
    
        </div>            
        </div>